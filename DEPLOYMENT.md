# Housing Buddy 배포 가이드

## 🚀 배포 준비사항

### 1. 환경 변수 설정
```bash
# 필수 환경변수
DATABASE_URL=postgresql://...
RESEND_API_KEY=re_...
SESSION_SECRET=your-secret-key

# 선택 환경변수
CLOUDINARY_CLOUD_NAME=your-cloudinary-name
CLOUDINARY_API_KEY=your-cloudinary-key
CLOUDINARY_API_SECRET=your-cloudinary-secret
GOOGLE_TRANSLATE_API_KEY=your-google-key
```

### 2. 데이터베이스 설정
```bash
# 스키마 생성
npm run db:push

# 또는 수동으로 스키마 실행
psql $DATABASE_URL < database_schema.sql
```

### 3. 의존성 설치
```bash
npm install
```

### 4. 빌드 및 실행
```bash
# 개발 환경
npm run dev

# 프로덕션 환경
npm run build
npm start
```

## 🔧 Replit 배포

### 자동 배포 설정
1. Replit에서 "Deploy" 버튼 클릭
2. "Autoscale" 또는 "Reserved VM" 선택
3. 환경 변수 설정 (Secrets 탭)
4. 배포 완료

### 헬스체크 엔드포인트
- `/` - 메인 헬스체크
- `/api/health` - API 헬스체크
- `/health` - 서버 헬스체크

## 📊 현재 상태 (2025-07-11)

### 데이터베이스 사용량
- **총 크기**: 8.9MB / 512MB (1.7% 사용)
- **매물**: 5개 (활성 4개, 삭제 1개)
- **사용자**: 7명
- **댓글**: 3개

### 외부 서비스 상태
- ✅ Neon PostgreSQL (무료 티어)
- ✅ Resend Email (무료 티어)
- ❌ Cloudinary (설정 필요)
- ❌ Google Translate (설정 필요)

### 성능 최적화
- PostgreSQL 세션 스토어 사용
- 이미지 최적화 (Cloudinary)
- 캐싱 시스템 준비
- 압축 및 minification

## 🔐 보안 설정

### 필수 보안 사항
1. **환경 변수 보호**: `.env` 파일 git에 포함하지 않기
2. **세션 보안**: 강력한 SESSION_SECRET 사용
3. **API 키 보호**: 프론트엔드에서 API 키 노출 방지
4. **SQL 인젝션 방지**: Drizzle ORM 사용으로 자동 방지

### 권장 보안 사항
1. **HTTPS 강제**: 프로덕션에서 SSL 인증서 설정
2. **Rate Limiting**: API 호출 제한 설정
3. **CORS 설정**: 허용된 도메인만 접근 허용
4. **로그 모니터링**: 에러 및 보안 로그 추적

## 📈 모니터링

### 로그 확인
```bash
# 서버 로그
npm run dev

# 데이터베이스 연결 확인
psql $DATABASE_URL -c "SELECT 1"

# API 테스트
curl https://your-domain.com/api/health
```

### 주요 지표
- 응답 시간
- 데이터베이스 연결 상태
- 메모리 사용량
- 디스크 사용량
- API 호출 수

## 🆘 문제 해결

### 일반적인 문제들
1. **콜드 스타트**: Neon DB 5분 슬립 후 첫 요청 지연
2. **세션 오류**: SESSION_SECRET 변경 시 기존 세션 무효화
3. **이미지 업로드**: Cloudinary 설정 없으면 업로드 실패
4. **번역 기능**: Google Translate API 키 없으면 번역 불가

### 디버깅 명령어
```bash
# 데이터베이스 연결 테스트
node -e "console.log(process.env.DATABASE_URL)"

# 포트 확인
netstat -tulpn | grep :5000

# 로그 확인
tail -f logs/server.log
```

## 🔄 업데이트 가이드

### 새 버전 배포
1. 코드 변경 사항 확인
2. 데이터베이스 마이그레이션 실행
3. 환경 변수 업데이트
4. 배포 실행
5. 헬스체크 확인

### 롤백 절차
1. 이전 버전 코드로 복원
2. 데이터베이스 백업에서 복원 (필요시)
3. 환경 변수 이전 상태로 복원
4. 서비스 재시작

---
*Last Updated: 2025-07-11*
*Generated by: Housing Buddy Development Team*